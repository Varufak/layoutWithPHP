# Шаблон для проектов на PHP

## Запуск площадки
Нужно, чтобы был установлен Docker, потому что шаблон работает на нём.

1. Распаковываем этот репозиторий в папку, где будем работать с проектом:
```shell
git clone git@github.com:Su-pr007/php-project-template.git
```

Копируем файл `.env.example` с новым именем `.env`. В файле `.env` находятся конфиги для конкретных площадок, где будет запускаться этот проект.
Для того, чтобы на каждом устройстве, где будет работать этот проект, при изменении конфигов, гит не ругался на изменения в нём, он находится в гитигноре. Поэтому его изменение возможно без проблем.

2. Создаём папку _www_. Там будет лежать код проекта, который будет работать на PHP.
```shell
mkdir www
```

3. В папке _www_ создаём файл index.php. Это главный файл, он будет запускаться при обращении к http://localhost.
Папка _www_ прописана в _.gitignore_, поэтому для этого репозитория не видна. Внутри неё можно без проблем создать новый репозиторий, который будет работать отдельно от этого шаблона.
На этом же этапе можем создать в этой папке новый репозиторий:
```shell
git init
```
Либо сделать это позже


4. Запускаем докер контейнеры:
```shell
docker-compose up -d
```
Флаг _-d_ нужен для того, чтобы docker-compose запустил контейнеры в режиме "detached", то есть в фоне. Если не указывать этот флаг:
- Контейнеры начнут сыпать логи своей работы в терминал
- Мы не сможем этой же сессией терминала, не выключив контейнеры

Если же мы всё-таки запустили контейнеры без этого параметра, выключить их можно нажав комбинацию ```Ctrl + C```. Эта комбинация почти в любом терминале работает как команда "Отмена"

## Выключение

Для выключения докер контейнеров, используем эту команду:
```shell
docker-compose down
```



## Объяснение структуры

Проект работает на языке программирования PHP, и "взаимодействует с миром" через Nginx.
Nginx - http-сервер. Он отвечает за общение между языками программирования и браузерами.

Для настройки Nginx, в этом шаблоне есть файл [nginx/configs/default.conf](nginx/configs/default.conf).
Записанных настроек хватает для запуска простого проекта без излишеств.

После запуска проекта, рядом с конфигами Nginx можно увидеть папку nginx/logs. В ней будут находиться логи о работе Nginx.
При возникновении ошибок с ним, можно проверять их.
Эта папка находится вне гита, чтобы не засорять его.

Папка _www_ является папкой проекта. Она "монтируется" внутрь докер контейнера с PHP. Монтирование позволяет изменять файлы в своей операционной системе, и видеть изменения сразу в докер контейнере. По сути это просто создание ссылки. В докер контейнер попадает ссылка на эту папку, и он работает напрямую с ней, а не с виртуальными папками.

Файл _.env.example_ является примером файла _.env_, и нужен только для того, чтобы хранить пример содержимого конфигурационного файла. Основной файл игнорируется гитом, поэтому в нём хранить данные не получится.

Файл _docker-compose.yaml_ является конфигурацией для утилиты Docker-compose. Он позволяет сохранять в себе настройки для какой-либо сборки контейнеров.
Конкретно в нашем случае, в нём заполнены настройки для двух контейнеров. Nginx и PHP.
В файле указано:
1. Какой образ использовать для создания контейнеров (_image_),
2. С какими портами контейнер будет работать (_ports_),
3. Какие папки нужно монтировать (_volumes_),
4. Переменные окружения (_environment_), для передачи контейнеру каких-то настроек,
5. При каких исключительных ситуациях контейнер следует перезагружать (_restart_). Здесь можно указать, что при возникновении проблем с работой контейнера, его следует отключить, либо попытаться перезагрузить. У нас указано "_always_", что означает что при любом незапланированном отключении контейнера, его следует попытаться перезагрузить

Docker-compose является утилитой для Docker, которая устанавливается вместе с ним.
Все те же действия, которые может docker-compose, можно выполнить напрямую через команды Docker, но тогда придётся писать длинную команду с параметрами для запуска каждого контейнера.
Docker-compose позволяет один раз записать все нужные конфигурации в файле, и пользоваться им для запуска всего проекта одной командой.



## Перезапись репозитория

Если нужно сохранить весь этот проект в своём собственном репозитории, после скачивания себе на компьютер, удаляем папку _.git_, и работаем с папкой как с новой. Создаём новый репозиторий (git init), коммитим что нужно, и пушим куда хотим


